### **Spring Bean自动装配（Autowiring）模式详解**

#### **一、核心概念：自动装配 vs 手动装配**

| 装配方式     | 核心区别                                                     | 配置方式（XML示例）                                          |
| :----------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| **手动装配** | 开发者**显式指定**每个依赖项的引用。                         | 使用 `<property>` 标签的 `ref` 或 `value` 属性。             |
| **自动装配** | Spring容器根据**特定规则**，**自动发现**并注入Bean之间的依赖关系。 | 在 `<bean>` 标签上设置 **`autowire`** 属性，或在Java配置/注解中启用。 |

**简单比喻：**

*   **手动装配**：像组装一台台式电脑，你需要自己购买并连接CPU、内存、硬盘等每一个部件。
*   **自动装配**：像购买一台笔记本电脑，厂家已经根据标准配置，帮你把所有的硬件都组装好了。

---

#### **二、XML配置中的四种自动装配模式**

通过在Bean定义中设置 `autowire` 属性，可以指定以下四种自动装配策略：

| 模式                    | `autowire` 值 | 工作原理                                                     | 适用场景与注意事项                                           |
| :---------------------- | :------------ | :----------------------------------------------------------- | :----------------------------------------------------------- |
| **byName**              | `byName`      | Spring根据**属性名**在容器中查找**同名（id/name）的Bean**进行注入。 | 依赖Bean的名称具有唯一性且与属性名一致时使用。简单直观。     |
| **byType**              | `byType`      | Spring根据**属性类型**在容器中查找**类型匹配的Bean**进行注入。 | 更常用。但当容器中存在**多个同类型Bean**时，会抛出 `NoUniqueBeanDefinitionException`。此时需配合 `@Qualifier` 指定具体Bean。 |
| **constructor**         | `constructor` | 类似于 `byType`，但应用于**构造器参数**。Spring会寻找与构造器参数类型匹配的Bean进行注入。 | 用于**构造器注入**。同样需注意多个同类型Bean的歧义问题。     |
| **autodetect** (已弃用) | `autodetect`  | **先尝试 `constructor` 模式，如果失败则回退到 `byType` 模式。** | 早期Spring版本中用于自动选择注入方式，**Spring 3.0 后已弃用**，推荐使用注解驱动。 |

**XML配置示例：**

```xml
<bean id="customer" class="com.example.Customer" autowire="byType"/>
<!-- Spring会自动寻找类型为 Person 的Bean，注入到customer的person属性中 -->
```

---

#### **三、现代Spring开发：注解驱动的自动装配**

在基于Java配置和注解的现代Spring开发中，自动装配主要通过以下注解实现，它比XML的 `autowire` 属性更强大、更精确。

| 注解                      | 作用位置                     | 核心功能                                                     | 等效XML配置                                     |
| :------------------------ | :--------------------------- | :----------------------------------------------------------- | :---------------------------------------------- |
| **`@Autowired`** (Spring) | **字段、Setter方法、构造器** | **按类型自动装配**。是Spring原生的注解。                     | `autowire="byType"` 或 `autowire="constructor"` |
| **`@Inject`** (JSR-330)   | **字段、Setter方法、构造器** | **按类型自动装配**。是Java标准（JSR-330）注解，功能与 `@Autowired` 几乎相同。 | 同 `@Autowired`                                 |
| **`@Resource`** (JSR-250) | **字段、Setter方法**         | **默认按名称装配**。如果未指定名称，则退而按类型装配。       | `autowire="byName"`                             |

**关键特性与组合使用：**

1. **`@Primary`**：当存在多个同类型候选Bean时，标记为首选Bean，解决 `byType` 的歧义问题。

2. **`@Qualifier`**：与 `@Autowired` 配合使用，在按类型匹配的基础上，**进一步按Bean的名称（限定符）进行筛选**，精确指定要注入的Bean。

   ```java
   @Autowired
   @Qualifier("mainDataSource") // 指定注入名为`mainDataSource`的DataSource
   private DataSource dataSource;
   ```